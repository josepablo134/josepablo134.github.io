<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>microMiddlewares: I2C/src/TivaCTM4C1294/DriverI2C.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">microMiddlewares<span id="projectnumber">&#160;0.0.0</span>
   </div>
   <div id="projectbrief">This project holds a simple middleware interface for each common internal peripheral used in embedded projects for Tiva C. This middlewares were tested on FreeRTOS.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0492bf3f11d1d3b6bad554bc08778e95.html">I2C</a></li><li class="navelem"><a class="el" href="dir_39d666ab9bbbf55315d2b309ceb6fafd.html">src</a></li><li class="navelem"><a class="el" href="dir_ffd8eb49dd785657759cd0a32c4946e6.html">TivaCTM4C1294</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">DriverI2C.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>TivaC TM4C1294 specific implementation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="_driver_i2_c_8h_source.html">I2C/DriverI2C.h</a>&gt;</code><br />
<code>#include &lt;I2C/TivaCTM4C1294/DriverI2C_config.h&gt;</code><br />
<code>#include &lt;inc/hw_i2c.h&gt;</code><br />
<code>#include &lt;inc/hw_ints.h&gt;</code><br />
<code>#include &lt;inc/hw_memmap.h&gt;</code><br />
<code>#include &lt;inc/hw_types.h&gt;</code><br />
<code>#include &lt;inc/hw_gpio.h&gt;</code><br />
<code>#include &lt;driverlib/rom.h&gt;</code><br />
<code>#include &lt;driverlib/flash.h&gt;</code><br />
<code>#include &lt;driverlib/gpio.h&gt;</code><br />
<code>#include &lt;driverlib/i2c.h&gt;</code><br />
<code>#include &lt;driverlib/pin_map.h&gt;</code><br />
<code>#include &lt;driverlib/sysctl.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a637b3516678f1deb5f6a3781aa8d2458"><td class="memItemLeft" align="right" valign="top"><a id="a637b3516678f1deb5f6a3781aa8d2458" name="a637b3516678f1deb5f6a3781aa8d2458"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SET_RECEIVE</b>(BASE)&#160;&#160;&#160;HWREG(BASE + I2C_O_MSA) |= 0x01;</td></tr>
<tr class="memdesc:a637b3516678f1deb5f6a3781aa8d2458"><td class="mdescLeft">&#160;</td><td class="mdescRight">Include Middleware description. <br /></td></tr>
<tr class="separator:a637b3516678f1deb5f6a3781aa8d2458"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6046035700315f7d8506771c50ebd2d1"><td class="memItemLeft" align="right" valign="top"><a id="a6046035700315f7d8506771c50ebd2d1" name="a6046035700315f7d8506771c50ebd2d1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SET_TRANSMIT</b>(BASE)&#160;&#160;&#160;HWREG(BASE + I2C_O_MSA) &amp;= ~0x01;</td></tr>
<tr class="separator:a6046035700315f7d8506771c50ebd2d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a253dab1dcbd06bbc1ef951fd20c47d0b"><td class="memItemLeft" align="right" valign="top"><a id="a253dab1dcbd06bbc1ef951fd20c47d0b" name="a253dab1dcbd06bbc1ef951fd20c47d0b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>START_TRANSMITION</b>&#160;&#160;&#160;0x00</td></tr>
<tr class="separator:a253dab1dcbd06bbc1ef951fd20c47d0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af25d72c70c96188123794118b2252bb3"><td class="memItemLeft" align="right" valign="top"><a id="af25d72c70c96188123794118b2252bb3" name="af25d72c70c96188123794118b2252bb3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONT_TRANSMITION</b>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:af25d72c70c96188123794118b2252bb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7cfa1e7599878f5f59f986ac0a685f4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_driver_i2_c_8c.html#a7cfa1e7599878f5f59f986ac0a685f4a">DriverI2C_init</a> (void)</td></tr>
<tr class="memdesc:a7cfa1e7599878f5f59f986ac0a685f4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize i2c buffer.  <br /></td></tr>
<tr class="separator:a7cfa1e7599878f5f59f986ac0a685f4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4798c739d08cdcebbf178ca8bdb5fec2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_driver_i2_c_8c.html#a4798c739d08cdcebbf178ca8bdb5fec2">DriverI2C_open</a> (unsigned int i2c_device)</td></tr>
<tr class="memdesc:a4798c739d08cdcebbf178ca8bdb5fec2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire a file descriptor for i2c.  <br /></td></tr>
<tr class="separator:a4798c739d08cdcebbf178ca8bdb5fec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34601c5ee85936c5e52cfe091286887b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_driver_i2_c_8c.html#a34601c5ee85936c5e52cfe091286887b">DriverI2C_ioctl</a> (int fd, unsigned int config, void *buffer)</td></tr>
<tr class="memdesc:a34601c5ee85936c5e52cfe091286887b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Special configuration can be set or read.  <br /></td></tr>
<tr class="separator:a34601c5ee85936c5e52cfe091286887b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeeca40aefac571903a47760d4608d059"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_driver_i2_c_8c.html#aeeca40aefac571903a47760d4608d059">DriverI2C_close</a> (int fd)</td></tr>
<tr class="memdesc:aeeca40aefac571903a47760d4608d059"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release a file descriptor for i2c.  <br /></td></tr>
<tr class="separator:aeeca40aefac571903a47760d4608d059"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74468e50b20dd6c4660e071cc6d6ebdb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_driver_i2_c_8c.html#a74468e50b20dd6c4660e071cc6d6ebdb">DriverI2C_write</a> (int fd, const void *buffer, unsigned int size)</td></tr>
<tr class="memdesc:a74468e50b20dd6c4660e071cc6d6ebdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a byte array with length from 1 to 4Gb, the buffer stores the data and should be persistent while the transaction take place.  <br /></td></tr>
<tr class="separator:a74468e50b20dd6c4660e071cc6d6ebdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99d5097837ae4cd63ff25750f7c2df25"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_driver_i2_c_8c.html#a99d5097837ae4cd63ff25750f7c2df25">DriverI2C_read</a> (int fd, void *buffer, unsigned int size)</td></tr>
<tr class="memdesc:a99d5097837ae4cd63ff25750f7c2df25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a byte array with length from 1 to 4Gb, the buffer stores the data and should be persistent while the transaction take place.  <br /></td></tr>
<tr class="separator:a99d5097837ae4cd63ff25750f7c2df25"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>TivaC TM4C1294 specific implementation. </p>
<dl class="section version"><dt>Version</dt><dd>0.0 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Josepablo Cruz Baas </dd></dl>
<dl class="section date"><dt>Date</dt><dd>08/26/2020 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aeeca40aefac571903a47760d4608d059" name="aeeca40aefac571903a47760d4608d059"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeeca40aefac571903a47760d4608d059">&#9670;&#160;</a></span>DriverI2C_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DriverI2C_close </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release a file descriptor for i2c. </p>
<p>Release a file descriptor. </p>
<p>&lt; Nothing to do</p>

</div>
</div>
<a id="a7cfa1e7599878f5f59f986ac0a685f4a" name="a7cfa1e7599878f5f59f986ac0a685f4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cfa1e7599878f5f59f986ac0a685f4a">&#9670;&#160;</a></span>DriverI2C_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DriverI2C_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize i2c buffer. </p>
<p>Initialize and clear driver registers. </p>

</div>
</div>
<a id="a34601c5ee85936c5e52cfe091286887b" name="a34601c5ee85936c5e52cfe091286887b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34601c5ee85936c5e52cfe091286887b">&#9670;&#160;</a></span>DriverI2C_ioctl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DriverI2C_ioctl </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Special configuration can be set or read. </p>
<p>Example of use</p>
<div class="fragment"><div class="line">uint8_t tempBuffer[] = { 0x00, 0x00, 0x00 };</div>
<div class="line">uint8_t regAddr = 0x55;</div>
<div class="line"><a class="code hl_function" href="_driver_i2_c_8h.html#a34601c5ee85936c5e52cfe091286887b">DriverI2C_ioctl</a>( i2cFd , <a class="code hl_define" href="_driver_i2_c_8h.html#a5305c9bd2bae3c592770a0d50adea81b">DriverI2C_IOCTL_CMD_READ_REG</a> | regAddr , tempBuffer );</div>
<div class="ttc" id="a_driver_i2_c_8h_html_a34601c5ee85936c5e52cfe091286887b"><div class="ttname"><a href="_driver_i2_c_8h.html#a34601c5ee85936c5e52cfe091286887b">DriverI2C_ioctl</a></div><div class="ttdeci">int DriverI2C_ioctl(int fd, unsigned int config, void *buffer)</div><div class="ttdoc">Special configuration can be set or read.</div><div class="ttdef"><b>Definition:</b> DriverI2C.c:79</div></div>
<div class="ttc" id="a_driver_i2_c_8h_html_a5305c9bd2bae3c592770a0d50adea81b"><div class="ttname"><a href="_driver_i2_c_8h.html#a5305c9bd2bae3c592770a0d50adea81b">DriverI2C_IOCTL_CMD_READ_REG</a></div><div class="ttdeci">#define DriverI2C_IOCTL_CMD_READ_REG</div><div class="ttdoc">Send a single byte and receive a single byte.</div><div class="ttdef"><b>Definition:</b> DriverI2C.h:57</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>a file descriptor. </td></tr>
    <tr><td class="paramname">config</td><td>integer bit mask that represents the io operation. </td></tr>
    <tr><td class="paramname">*buffer</td><td>a byte array that holds any shareable buffer depending on io operation. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>DriverI2C_ERROR or 0 in case of success. </dd></dl>
<p>Change the i2c slave address</p>
<p>Change the i2c speed to 100Kbps</p>
<p>Change the i2c speed to 400Kbps</p>
<p>Release the i2c bus in idle state</p>
<p>&lt; Stop hard state machine</p>
<p>Send a simple byte with stop bit</p>
<p>Set data to send</p>
<p>Begin transaction</p>
<p>Wait any interrupt set</p>
<p>Check for transaction error</p>
<p>Receive a simple byte with stop bit</p>
<p>If there is not buffer available return error!</p>
<p>Wait any interrupt set</p>
<p>Check for transaction error</p>
<p>Send a single byte and read a single byte</p>
<p>If there is not buffer available return error!</p>
<p>Wait any interrupt set</p>
<p>Check for transaction error</p>
<p>&lt; Check for transaction error</p>
<p>Wait any interrupt set</p>

</div>
</div>
<a id="a4798c739d08cdcebbf178ca8bdb5fec2" name="a4798c739d08cdcebbf178ca8bdb5fec2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4798c739d08cdcebbf178ca8bdb5fec2">&#9670;&#160;</a></span>DriverI2C_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DriverI2C_open </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>i2c_device</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Acquire a file descriptor for i2c. </p>
<p>Acquire a file descriptor for the peripheral. </p>

</div>
</div>
<a id="a99d5097837ae4cd63ff25750f7c2df25" name="a99d5097837ae4cd63ff25750f7c2df25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99d5097837ae4cd63ff25750f7c2df25">&#9670;&#160;</a></span>DriverI2C_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DriverI2C_read </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive a byte array with length from 1 to 4Gb, the buffer stores the data and should be persistent while the transaction take place. </p>
<p>Begins a transaction with a control byte sending the i2c address first with the reading flag active. The rest of the transaction are the bytes from slave. In case of any transaction error, stops the transaction returning the bus to the idle state. In case of success transaction, the line does not return to the idle state.</p>
<dl class="section return"><dt>Returns</dt><dd>int32_t total of bytes received, in case of error returns DriverI2C_ERROR </dd></dl>
<p>&lt; No buffer , size too small</p>
<p>Set i2c hardware for reception</p>
<p>Begin a multi transaction</p>
<p>Wait for transaction to finish</p>
<p>&lt; Stop hard state machine</p>
<p>For a burst send operation do</p>
<p>Wait for transaction to finish</p>
<p>&lt; Stop hard state machine</p>

</div>
</div>
<a id="a74468e50b20dd6c4660e071cc6d6ebdb" name="a74468e50b20dd6c4660e071cc6d6ebdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74468e50b20dd6c4660e071cc6d6ebdb">&#9670;&#160;</a></span>DriverI2C_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DriverI2C_write </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a byte array with length from 1 to 4Gb, the buffer stores the data and should be persistent while the transaction take place. </p>
<p>Begins a transaction with a control byte sending the i2c address first, followed by the buffer content. In case of any transaction error, stops the transaction returning the bus to the idle state. In case of success transaction, the line does not return to the idle state.</p>
<dl class="section return"><dt>Returns</dt><dd>int32_t total of bytes sended, in case of error returns DriverI2C_ERROR </dd></dl>
<p>&lt; No buffer , size too small</p>
<p>Set i2c hardware for transaction</p>
<p>Send first byte</p>
<p>Begin a multi transaction</p>
<p>Wait for transaction to finish</p>
<p>&lt; Stop hard state machine</p>
<p>For every byte to send do</p>
<p>Wait for transaction to finish</p>
<p>&lt; Stop hard state machine</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
